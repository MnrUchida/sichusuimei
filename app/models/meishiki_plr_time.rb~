# coding : utf-8

require 'date'

class MeishikiPlrTime < MeishikiPlr

  def setData(_meishiki)
    super
    self.piller = 'time'
  end
   
  def getTimeInMeikyu
    month = @meishikiData.month

    if beforeSekki?() == true then
      month = month - 1
    end

    return ((month + 6 - @meishikiData.day) % Chishi::CHISHI_COUNT) * 2
  end

  # 天干、地支の取得
  def getTenkanChishi

    # 西暦の日数を取得
    year = @meishikiData.year - 1
    days = year*365 + (year/4).truncate - (year/100).truncate + (year/ 400).truncate
    meishiki_date = @meishikiData.getMeishikiDate
    days = days + meishiki_date.strftime("%j").to_i

    # 命宮を考慮し、時間を算出
    time = @meishikiData.time
    if time == nil then
      time = getTimeInMeikyu
    end 

    # 天干、地支の算出
    tenkanTime = (days - 6) * 24 + (time +1) % 24
    chishiTime = (days - 10) * 24 + (time +1) % 24

    tenkan = ((tenkanTime / 2) % Jikkan::JIKKAN_COUNT) + 1
    chishi = ((chishiTime / 2) % Chishi::CHISHI_COUNT) + 1

    return tenkan,chishi
  end
end

